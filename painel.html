<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OceanStore - Admin</title>
  <link rel="icon" type="image/png" href="https://i.imgur.com/U9aXSQB.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/@phosphor-icons/web@2.1.1/src/regular/style.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --cyan-primary: #75afca;
      --cyan-dark: #6095af;
      --cyan-light: #7dd3fc;
      --cyan-muted: #f0f9ff;
      --white: #ffffff;
      --gray-50: #f8fafc;
      --gray-100: #f1f5f9;
      --gray-200: #e2e8f0;
      --gray-300: #cbd5e1;
      --gray-400: #94a3b8;
      --gray-500: #64748b;
      --gray-600: #475569;
      --gray-700: #334155;
      --gray-800: #1e293b;
      --gray-900: #0f172a;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: var(--gray-50);
      min-height: 100vh;
      color: var(--gray-800);
    }

    #profile-header {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
    }

    .profile-trigger {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 6px 12px 6px 6px;
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 2px solid var(--gray-200);
      border-radius: 15px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .profile-avatar {
      width: 34px;
      height: auto;
    }

    .profile-nick {
      font-weight: 600;
      font-size: 13px;
      color: var(--gray-800);
      max-width: 120px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .profile-trigger svg {
      color: var(--gray-500);
    }

    .profile-dropdown {
      position: absolute;
      top: calc(100% + 8px);
      right: 0;
      width: 260px;
      background: white;
      border: 2px solid var(--gray-200);
      border-radius: 16px;
      padding: 8px 0;
      display: none;
    }

    .profile-dropdown.active {
      display: block;
      animation: fadeIn 0.2s ease;
    }

    .dropdown-user {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      border-bottom: 1px solid var(--gray-100);
    }

    .dropdown-avatar {
      width: 40px;
      height: 42px;
      border-radius: 9px;
      border: 2px solid var(--cyan-primary);
    }

    .dropdown-user-info {
      display: flex;
      flex-direction: column;
    }

    .dropdown-user-nick {
      font-weight: 600;
      font-size: 15px;
      color: var(--gray-800);
      margin-bottom: 2px;
    }

    .dropdown-user-points {
      font-size: 12px;
      color: var(--cyan-primary);
      font-weight: 500;
    }

    .dropdown-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 16px;
      font-size: 14px;
      color: var(--gray-700);
      text-decoration: none;
      transition: all 0.2s ease;
      width: 100%;
      background: none;
      border: none;
      cursor: pointer;
      font-family: 'Poppins', sans-serif;
    }

    .dropdown-item:hover {
      background: var(--gray-50);
      color: var(--cyan-primary);
    }

    .dropdown-item svg {
      color: currentColor;
      opacity: 0.8;
    }

    .dropdown-divider {
      height: 1px;
      background: var(--gray-200);
      margin: 8px 0;
    }

    .logout-btn {
      color: var(--danger);
    }

    .logout-btn:hover {
      background: #fee2e2;
      color: #dc2626;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .toast {
      position: fixed;
      bottom: 24px;
      right: 24px;
      min-width: 300px;
      max-width: 400px;
      background: white;
      border: 2px solid var(--gray-200);
      border-radius: 12px;
      padding: 16px 20px;
      display: flex;
      align-items: center;
      gap: 12px;
      box-shadow: 0 12px 24px rgba(0,0,0,0.1);
      animation: slideUp 0.3s ease;
      z-index: 9999;
    }

    .toast.toast-success {
      border-color: var(--success);
      background: #d1fae5;
    }

    .toast.toast-error {
      border-color: var(--danger);
      background: #fee2e2;
    }

    .toast.toast-warning {
      border-color: var(--warning);
      background: #fef3c7;
    }

    .toast svg {
      width: 24px;
      height: 24px;
      flex-shrink: 0;
    }

    .toast span {
      font-size: 14px;
      color: var(--gray-800);
      flex: 1;
    }

    .toast-hide {
      animation: slideDown 0.3s ease forwards;
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes slideDown {
      from {
        opacity: 1;
        transform: translateY(0);
      }
      to {
        opacity: 0;
        transform: translateY(20px);
      }
    }

    .sidebar {
      position: fixed;
      left: 0;
      top: 0;
      width: 260px;
      height: 100vh;
      background: var(--white);
      border-right: 2px solid var(--gray-200);
      padding: 22px 0;
    }

    .sidebar-logo {
      padding: 0 18px 18px;
      border-bottom: 2px solid var(--gray-200);
      margin-bottom: 16px;
    }

    .sidebar-logo a {
      display: flex;
      align-items: center;
      gap: 12px;
      text-decoration: none;
    }

    .sidebar-logo-icon {
      width: 44px !important;
      height: 44px !important;
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
      padding: 0 !important;
      margin: 0 !important;
    }

    .sidebar-logo-icon img {
      width: 46px !important;
      height: 46px !important;
      max-width: none !important;
      max-height: none !important;
      object-fit: contain !important;
      display: block !important;
      position: relative !important;
      transform: scale(1.1);
    }

    .sidebar-logo-text {
      font-size: 22px;
      font-weight: 700;
      color: var(--gray-800);
    }

    .nav-menu {
      list-style: none;
      padding: 0 12px;
    }

    .nav-item {
      margin-bottom: 4px;
    }

    .nav-link {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      border-radius: 10px;
      text-decoration: none;
      color: var(--gray-600);
      font-size: 14px;
      font-weight: 500;
      transition: all 0.2s ease;
    }

    .nav-link:hover {
      background: var(--gray-50);
      color: var(--gray-800);
    }

    .nav-link.active {
      background: var(--cyan-muted);
      color: var(--cyan-primary);
    }

    .nav-link svg {
      width: 20px;
      height: 20px;
    }

    .main-content {
      margin-left: 260px;
      padding: 32px;
      min-height: 100vh;
    }

    .page-header {
      margin-bottom: 32px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .page-header h1 {
      font-size: 32px;
      font-weight: 700;
      color: var(--gray-800);
      margin-bottom: 8px;
    }

    .page-header p {
      font-size: 15px;
      color: var(--gray-500);
    }

    .header-actions {
      display: flex;
      gap: 10px;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 24px;
      margin-bottom: 32px;
    }

    .stat-card {
      background: var(--white);
      border: 2px solid var(--gray-200);
      border-radius: 16px;
      padding: 24px;
    }

    .stat-card .label {
      font-size: 12px;
      color: var(--gray-500);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 8px;
    }

    .stat-card .value {
      font-size: 36px;
      font-weight: 700;
      color: var(--gray-800);
    }

    .admin-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 24px;
      border-bottom: 2px solid var(--gray-200);
      padding-bottom: 16px;
      flex-wrap: wrap;
    }

    .tab-btn {
      font-family: 'Poppins', sans-serif;
      padding: 10px 20px;
      font-size: 14px;
      font-weight: 500;
      border: none;
      border-radius: 10px;
      background: transparent;
      color: var(--gray-600);
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .tab-btn:hover {
      background: var(--gray-100);
      color: var(--gray-800);
    }

    .tab-btn.active {
      background: linear-gradient(135deg, var(--cyan-primary), var(--cyan-dark));
      color: var(--white);
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
      animation: fadeIn 0.3s ease;
    }

    .panel {
      background: var(--white);
      border: 2px solid var(--gray-200);
      border-radius: 16px;
      overflow-x: auto;
    }

    .panel-header {
      padding: 20px 24px;
      border-bottom: 2px solid var(--gray-200);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .panel-title {
      font-size: 16px;
      font-weight: 600;
      color: var(--gray-800);
    }

    .data-table {
      width: 100%;
      border-collapse: collapse;
    }

    .data-table th,
    .data-table td {
      padding: 16px 24px;
      text-align: left;
      font-size: 14px;
    }

    .data-table th {
      background: var(--gray-50);
      font-weight: 600;
      color: var(--gray-600);
      text-transform: uppercase;
      font-size: 11px;
      letter-spacing: 0.5px;
    }

    .data-table tr {
      border-bottom: 2px solid var(--gray-100);
    }

    .data-table tr:last-child {
      border-bottom: none;
    }

    .status-badge {
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.3px;
    }

    .status-pending {
      background: #fef3c7;
      color: #d97706;
    }

    .status-approved {
      background: #d1fae5;
      color: #059669;
    }

    .status-rejected {
      background: #fee2e2;
      color: #dc2626;
    }

    .action-btns {
      display: flex;
      gap: 8px;
    }

    .icon-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
      border: none;
      border-radius: 8px;
      background: transparent;
      color: var(--gray-600);
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .icon-btn:hover {
      background: var(--gray-100);
      color: var(--cyan-primary);
    }

    .icon-btn.danger:hover {
      background: #fee2e2;
      color: #dc2626;
    }

    .icon-btn.success:hover {
      background: #d1fae5;
      color: #059669;
    }

    .icon-btn svg {
      width: 18px;
      height: 18px;
    }

    .btn {
      font-family: 'Poppins', sans-serif;
      padding: 8px 13px;
      font-size: 12px;
      font-weight: 600;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
      display: inline-flex;
      align-items: center;
      gap: 5px;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--cyan-primary), var(--cyan-dark));
      color: var(--white);
    }

    .btn-success {
      background: var(--success);
      color: var(--white);
    }

    .btn-success:hover {
      background: #059669;
    }

    .btn-danger {
      background: var(--danger);
      color: var(--white);
    }

    .btn-danger:hover {
      background: #dc2626;
    }

    .btn-secondary {
      background: var(--gray-100);
      color: var(--gray-700);
    }

    .btn-secondary:hover {
      background: var(--gray-200);
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      padding: 24px;
    }

    .form-group {
      margin-bottom: 16px;
    }

    .form-group.full-width {
      grid-column: span 2;
    }

    label {
      display: block;
      font-size: 12px;
      font-weight: 600;
      color: var(--gray-700);
      margin-bottom: 6px;
      text-transform: uppercase;
      letter-spacing: 0.3px;
    }

    input[type="text"],
    input[type="number"],
    input[type="datetime-local"],
    select,
    textarea {
      width: 100%;
      padding: 12px 14px;
      font-size: 14px;
      border: 2px solid var(--gray-200);
      border-radius: 8px;
      background: var(--white);
      color: var(--gray-800);
      transition: all 0.2s ease;
      font-family: 'Poppins', sans-serif;
    }

    input:focus,
    select:focus,
    textarea:focus {
      outline: none;
      border-color: var(--cyan-primary);
      box-shadow: 0 0 0 3px var(--cyan-muted);
    }

    select {
      cursor: pointer;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 256 256'%3E%3Cpath fill='%236b7280' d='M213.66,101.66l-80,80a8,8,0,0,1-11.32,0l-80-80A8,8,0,0,1,53.66,90.34L128,164.69l74.34-74.35a8,8,0,0,1,11.32,11.32Z'%3E%3C/path%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 14px center;
      background-size: 16px;
      padding-right: 44px;
    }

    textarea {
      min-height: 100px;
      resize: vertical;
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 2000;
      align-items: center;
      justify-content: center;
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: var(--white);
      border: 2px solid var(--gray-200);
      border-radius: 16px;
      width: 100%;
      max-width: 500px;
      padding: 32px;
    }

    .modal-header {
      margin-bottom: 24px;
    }

    .modal-header h2 {
      font-size: 20px;
      font-weight: 600;
      color: var(--gray-800);
    }

    .modal-footer {
      display: flex;
      gap: 12px;
      justify-content: flex-end;
      margin-top: 24px;
    }

    .loading {
      text-align: center;
      padding: 40px;
      color: var(--gray-500);
      font-size: 14px;
    }

    .switch {
      position: relative;
      display: inline-block;
      width: 60px;
      height: 34px;
    }

    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: var(--gray-300);
      transition: .3s;
      border-radius: 34px;
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 26px;
      width: 26px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: .3s;
      border-radius: 50%;
    }

    input:checked + .slider {
      background-color: var(--success);
    }

    input:checked + .slider:before {
      transform: translateX(26px);
    }

    .current-turn-box {
      background: linear-gradient(135deg, var(--cyan-muted), var(--white));
      border: 2px solid var(--cyan-primary);
      border-radius: 12px;
      padding: 16px 20px;
      margin-bottom: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .turn-info {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .turn-info .label {
      font-size: 12px;
      color: var(--gray-500);
      text-transform: uppercase;
    }

    .turn-info .value {
      font-size: 18px;
      font-weight: 700;
      color: var(--cyan-primary);
    }

    .timer {
      font-family: monospace;
      font-size: 24px;
      font-weight: 700;
      color: var(--cyan-dark);
    }

    .proof-thumb {
      max-width: 40px;
      max-height: 40px;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .proof-thumb:hover {
      transform: scale(2);
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }

    .banned-badge {
      background: #fee2e2;
      color: #dc2626;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 10px;
      font-weight: 600;
      margin-left: 8px;
    }

    @media (max-width: 1024px) {
      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      .form-grid {
        grid-template-columns: 1fr;
      }
      .form-group.full-width {
        grid-column: span 1;
      }
    }

    @media (max-width: 768px) {
      .sidebar {
        width: 100%;
        height: auto;
        position: relative;
        border-right: none;
        border-bottom: 2px solid var(--gray-200);
      }
      .main-content {
        margin-left: 0;
      }
      .admin-tabs {
        flex-wrap: wrap;
      }
      .data-table {
        display: block;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }
      .stats-grid {
        grid-template-columns: 1fr;
      }
    }

    .app-header {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 70px;
      background: #efefef14;
      backdrop-filter: blur(10px);
      border-bottom: 2px solid var(--gray-200);
      z-index: 998;
      padding: 0 20px;
      align-items: center;
      justify-content: space-between;
    }

    .app-header .header-logo {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .app-header .header-logo img {
      width: 40px;
      height: 40px;
      object-fit: contain;
    }

    .app-header .header-logo span {
      font-size: 20px;
      font-weight: 700;
      color: var(--gray-800);
    }

    .header-menu-toggle {
      background: none;
      color: black;
      border: none;
      width: 45px;
      height: 45px;
      font-size: 24px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .sidebar-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 999;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .sidebar-overlay.active {
      display: block;
      opacity: 1;
    }

    .sidebar-user-mobile {
      display: none;
      padding: 20px 16px;
      border-bottom: 2px solid var(--gray-200);
      margin-bottom: 16px;
      background: var(--gray-50);
    }

    .sidebar-user-mobile .user-info {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .sidebar-user-mobile .user-avatar {
      width: 45px;
      height: 47px;
      border-radius: 10px;
      border: 2px solid var(--cyan-primary);
    }

    .sidebar-user-mobile .user-details {
      display: flex;
      flex-direction: column;
    }

    .sidebar-user-mobile .user-nick {
      font-weight: 700;
      font-size: 16px;
      color: var(--gray-800);
      margin-bottom: 2px;
    }

    .sidebar-user-mobile .user-points {
      font-size: 13px;
      color: var(--cyan-primary);
      font-weight: 600;
    }

    .sidebar-logout-mobile {
      display: none;
      margin-top: auto;
      padding: 16px;
      border-top: 2px solid var(--gray-200);
    }

    .sidebar-logout-mobile button {
      display: flex;
      align-items: center;
      gap: 12px;
      width: 100%;
      padding: 14px 16px;
      background: #fee2e2;
      color: #dc2626;
      border: none;
      border-radius: 12px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      font-family: 'Poppins', sans-serif;
    }

    .sidebar-logout-mobile button:hover {
      background: #fecaca;
    }

    .sidebar-logout-mobile button i {
      font-size: 20px;
    }

    @media (max-width: 768px) {
      .app-header {
        display: flex;
      }

      .sidebar {
        position: fixed;
        left: -280px;
        top: 0;
        width: 260px;
        height: 100vh;
        z-index: 1000;
        transition: left 0.3s ease;
        box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        display: flex;
        flex-direction: column;
        padding-top: 0;
      }

      .sidebar.active {
        left: 0;
      }

      .sidebar-logo {
        display: none;
      }

      .sidebar-user-mobile {
        display: block;
        margin-top: 0;
      }

      .main-content {
        margin-left: 0;
        padding: 90px 16px 16px 16px;
      }

      .nav-menu {
        flex: 1;
        overflow-y: auto;
      }

      .main-content {
        margin-left: 0;
        padding: 70px 16px 16px 16px;
      }

      #profile-header {
        display: none;
      }

      .profile-trigger {
        padding: 4px 8px 4px 4px;
      }

      .profile-avatar {
        width: 30px;
      }

      .profile-nick {
        font-size: 12px;
        max-width: 80px;
      }

      .stats-grid {
        grid-template-columns: 1fr;
        gap: 12px;
      }

      .stat-card {
        padding: 16px;
      }

      .stat-card .value {
        font-size: 28px;
      }

      .admin-tabs {
        flex-wrap: wrap;
        gap: 4px;
      }

      .tab-btn {
        flex: 1 1 auto;
        padding: 8px 12px;
        font-size: 12px;
      }

      .data-table {
        display: block;
        overflow-x: auto;
        white-space: nowrap;
      }

      .data-table th,
      .data-table td {
        padding: 12px 16px;
        font-size: 13px;
      }

      .panel-header {
        padding: 16px;
        flex-direction: column;
        gap: 10px;
        align-items: flex-start;
      }

      .panel-header .btn {
        width: 100%;
      }

      .form-grid {
        grid-template-columns: 1fr;
        padding: 16px;
      }

      .form-group.full-width {
        grid-column: span 1;
      }

      .modal-content {
        margin: 16px;
        padding: 24px;
        max-width: none;
      }

      .two-columns {
        grid-template-columns: 1fr;
      }

      .points-bar {
        flex-direction: column;
        gap: 16px;
        text-align: center;
        padding: 16px;
      }

      .points-info {
        flex-direction: column;
        gap: 10px;
      }

      .points-progress {
        text-align: center;
        min-width: 100%;
      }

      .queue-info, .your-turn-info {
        flex-direction: column;
        text-align: center;
        padding: 16px;
      }

      .timer {
        margin-left: 0;
      }

      .rewards-grid {
        grid-template-columns: 1fr;
      }

      .reward-card {
        padding: 20px;
      }

      .current-turn-box {
        flex-direction: column;
        gap: 10px;
        text-align: center;
      }

      .turn-info {
        flex-direction: column;
        gap: 5px;
      }

      .action-btns {
        flex-wrap: wrap;
      }

      .btn {
        padding: 8px 12px;
        font-size: 12px;
      }

      .page-header {
        flex-direction: column;
        gap: 16px;
        align-items: flex-start;
      }

      .header-actions {
        width: 100%;
      }

      .header-actions .btn {
        width: 100%;
      }

      .next-opening {
        flex-direction: column;
        text-align: center;
        gap: 16px;
        padding: 16px;
      }

      .next-opening-info .date {
        font-size: 22px;
      }

      .next-opening-countdown .time {
        font-size: 24px;
      }

      .ranking-item {
        padding: 10px 16px;
      }

      .ranking-avatar {
        width: 30px;
      }

      .ranking-nick {
        font-size: 13px;
      }

      .redemption-item {
        padding: 12px 16px;
      }

      .redemption-avatar {
        width: 30px;
      }
    }
  </style>
</head>
<body>
  <header class="app-header">
    <div class="header-logo">
      <img src="https://i.imgur.com/U9aXSQB.png" alt="OceanStore">
      <span>OceanStore</span>
    </div>
    <button class="header-menu-toggle" id="menuToggle">
      <i class="ph ph-list"></i>
    </button>
  </header>
  <div class="sidebar-overlay" id="sidebarOverlay"></div>
    <aside class="sidebar">
    <div class="sidebar-user-mobile"></div>
    <div class="sidebar-logo">
      <a href="overview.html">
        <div class="sidebar-logo-icon">
          <img src="https://i.imgur.com/U9aXSQB.png" alt="OceanStore">
        </div>
        <span class="sidebar-logo-text">OceanStore</span>
      </a>
    </div>
    <nav>
      <ul class="nav-menu">
        <li class="nav-item">
          <a href="overview.html" class="nav-link">
            <i class="ph ph-house"></i>
            Dashboard
          </a>
        </li>
        <li class="nav-item">
          <a href="market.html" class="nav-link">
            <i class="ph ph-storefront"></i>
            Loja
          </a>
        </li>
        <li class="nav-item">
          <a href="redemption.html" class="nav-link">
            <i class="ph ph-ticket"></i>
            Resgates
          </a>
        </li>
        <li class="nav-item" id="admin-nav-item" style="display: block;">
          <a href="painel.html" class="nav-link active">
            <i class="ph ph-shield"></i>
            Admin
          </a>
        </li>
        <li class="nav-item">
          <a href="#" class="nav-link">
            <i class="ph ph-fish"></i>
            Fortune Fish
            <span style="margin-left: auto; font-size: 10px; color: var(--gray-400);">Em breve</span>
          </a>
        </li>
      </ul>
      <div class="sidebar-logout-mobile">
        <button onclick="Auth.logout()">
          <i class="ph ph-sign-out"></i>
          Sair
        </button>
      </div>
    </nav>
  </aside>

  <main class="main-content">
    <div class="page-header">
      <div>
        <h1>Painel Administrativo</h1>
        <p>Gerencie missões, recompensas, usuários e fila de resgate.</p>
      </div>
    </div>

    <div class="stats-grid">
      <div class="stat-card">
        <div class="label">Total de usuários</div>
        <div class="value" id="total-users">0</div>
      </div>
      <div class="stat-card">
        <div class="label">Missões hoje</div>
        <div class="value" id="missions-today">0</div>
      </div>
      <div class="stat-card">
        <div class="label">Pontos distribuídos</div>
        <div class="value" id="total-points">0</div>
      </div>
      <div class="stat-card">
        <div class="label">Resgates pendentes</div>
        <div class="value" id="pending-count">0</div>
      </div>
    </div>

    <div class="admin-tabs">
      <button class="tab-btn active" onclick="showTab('missions')">Gerenciar missões</button>
      <button class="tab-btn" onclick="showTab('pending-missions')">Missões pendentes</button>
      <button class="tab-btn" onclick="showTab('rewards')">Recompensas</button>
      <button class="tab-btn" onclick="showTab('users')">Usuários</button>
      <button class="tab-btn" onclick="showTab('queue')">Fila</button>
      <button class="tab-btn" onclick="showTab('store')">Configurações</button>
    </div>

    <div id="tab-missions" class="tab-content active">
      <div class="panel">
        <div class="panel-header">
          <h2 class="panel-title">Gerenciar missões</h2>
          <button class="btn btn-primary" onclick="openMissionModal()">
            <svg width="16" height="16" viewBox="0 0 256 256" fill="currentColor">
              <path d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm48-88a8,8,0,0,1-8,8H136v32a8,8,0,0,1-16,0V136H88a8,8,0,0,1,0-16h32V88a8,8,0,0,1,16,0v32h32A8,8,0,0,1,176,128Z"></path>
            </svg>
            NOVA MISSÃO
          </button>
        </div>
        <div class="loading" id="missions-loading">Carregando missões...</div>
        <table class="data-table" id="missions-table" style="display: none;">
          <thead>
            <tr>
              <th>Nome</th>
              <th>Descrição</th>
              <th>Pontos</th>
              <th>Ações</th>
            </tr>
          </thead>
          <tbody id="missions-body"></tbody>
        </table>
      </div>
    </div>

    <div id="tab-pending-missions" class="tab-content">
      <div class="panel">
        <div class="panel-header">
          <h2 class="panel-title">Missões pendentes</h2>
          <span class="status-badge status-pending" id="pending-missions-count">0 pendentes</span>
        </div>
        <div class="loading" id="pending-missions-loading">Carregando missões pendentes...</div>
        <table class="data-table" id="pending-missions-table" style="display: none;">
          <thead>
            <tr>
              <th>Usuário</th>
              <th>Missão</th>
              <th>Pontos</th>
              <th>Comprovante</th>
              <th>Data</th>
              <th>Ações</th>
            </tr>
          </thead>
          <tbody id="pending-missions-body"></tbody>
        </table>
      </div>
    </div>

    <div id="tab-rewards" class="tab-content">
      <div class="panel">
        <div class="panel-header">
          <h2 class="panel-title">Gerenciar recompensas</h2>
          <button class="btn btn-primary" onclick="openRewardModal()">
            <svg width="16" height="16" viewBox="0 0 256 256" fill="currentColor">
              <path d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm48-88a8,8,0,0,1-8,8H136v32a8,8,0,0,1-16,0V136H88a8,8,0,0,1,0-16h32V88a8,8,0,0,1,16,0v32h32A8,8,0,0,1,176,128Z"></path>
            </svg>
            Nova recompensa
          </button>
        </div>
        <div class="loading" id="rewards-loading">Carregando recompensas...</div>
        <table class="data-table" id="rewards-table" style="display: none;">
          <thead>
            <tr>
              <th>Nome</th>
              <th>Categoria</th>
              <th>Custo</th>
              <th>Imagem</th>
              <th>Ações</th>
            </tr>
          </thead>
          <tbody id="rewards-body"></tbody>
        </table>
      </div>
    </div>

    <div id="tab-users" class="tab-content">
      <div class="panel">
        <div class="panel-header">
          <h2 class="panel-title">Ranking de usuários</h2>
        </div>
        <div class="loading" id="users-loading">Carregando usuários...</div>
        <table class="data-table" id="users-table" style="display: none;">
          <thead>
            <tr>
              <th>Posição</th>
              <th>Nick</th>
              <th>Pontos</th>
              <th>Missões</th>
              <th>Admin</th>
              <th>Ações</th>
            </tr>
          </thead>
          <tbody id="users-body"></tbody>
        </table>
      </div>
    </div>

    <div id="tab-queue" class="tab-content">
      <div class="panel">
        <div class="panel-header">
          <h2 class="panel-title">Controle de fila</h2>
          <div>
            <span id="current-turn-info"></span>
            <button class="btn btn-primary" onclick="skipTurn()" id="skip-turn-btn">
              <svg width="16" height="16" viewBox="0 0 256 256" fill="currentColor">
                <path d="M232,128a104,104,0,1,1-32.26-74.27,8,8,0,1,1-11.48,11.14A88,88,0,1,0,208,183.67V152a8,8,0,0,1,16,0v48a8,8,0,0,1-8,8H168a8,8,0,0,1,0-16h31.2A103.94,103.94,0,0,1,232,128Z"></path>
              </svg>
              Pular vez
            </button>
          </div>
        </div>
        <div id="current-turn-box" class="current-turn-box" style="display: none;">
          <div class="turn-info">
            <span class="label">Vez atual:</span>
            <span class="value" id="current-turn-nick">---</span>
          </div>
          <div class="turn-info">
            <span class="label">Tempo restante:</span>
            <span class="timer" id="turn-timer">60:00</span>
          </div>
        </div>
        <div class="loading" id="queue-loading">Carregando fila...</div>
        <table class="data-table" id="queue-table" style="display: none;">
          <thead>
            <tr>
              <th>Posição</th>
              <th>Nick</th>
              <th>Pontos</th>
              <th>Resgates pendentes</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody id="queue-body"></tbody>
        </table>
      </div>
    </div>

    <div id="tab-store" class="tab-content">
      <div class="panel">
        <div class="panel-header">
          <h2 class="panel-title">Configurações da loja</h2>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label>Status da Loja</label>
            <label class="switch">
              <input type="checkbox" id="store-status" onchange="toggleStoreStatus()">
              <span class="slider"></span>
            </label>
          </div>
          <div class="form-group">
            <label for="next-opening">Próxima abertura</label>
            <input type="datetime-local" id="next-opening">
          </div>
          <div class="form-group full-width">
            <p style="color: var(--gray-500); font-size: 13px; margin-bottom: 12px;">
              ℹ️ A loja abre automaticamente todo dia 5 do mês e fecha após 5 dias (dia 10).
            </p>
            <button class="btn btn-primary" onclick="saveStoreSettings()">
              <svg width="16" height="16" viewBox="0 0 256 256" fill="currentColor">
                <path d="M216,96v96a16,16,0,0,1-16,16H56a16,16,0,0,1-16-16V64A16,16,0,0,1,56,48h96a8,8,0,0,1,5.66,2.34l56,56A8,8,0,0,1,216,112Zm-48,28a12,12,0,1,0-12,12A12,12,0,0,0,168,124Z"></path>
              </svg>
              Salvar configurações
            </button>
          </div>
        </div>
      </div>
    </div>
  </main>

  <div class="modal" id="mission-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="mission-modal-title">Nova missão</h2>
      </div>
      <div class="form-group">
        <label for="mission-name">Nome</label>
        <input type="text" id="mission-name" placeholder="Ex: Cumprir meta">
      </div>
      <div class="form-group">
        <label for="mission-description">Descrição</label>
        <textarea id="mission-description" placeholder="Descrição da missão"></textarea>
      </div>
      <div class="form-group">
        <label for="mission-points">Pontos</label>
        <input type="number" id="mission-points" placeholder="0" min="1">
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeMissionModal()">Cancelar</button>
        <button class="btn btn-primary" onclick="saveMission()">Salvar</button>
      </div>
    </div>
  </div>

  <div class="modal" id="reward-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Nova recompensa</h2>
      </div>
      <div class="form-group">
        <label for="reward-name">Nome</label>
        <input type="text" id="reward-name" placeholder="Nome da recompensa">
      </div>
      <div class="form-group">
        <label for="reward-description">Descrição</label>
        <textarea id="reward-description" placeholder="Descrição da recompensa"></textarea>
      </div>
      <div class="form-group">
        <label for="reward-category">Categoria</label>
        <select id="reward-category">
          <option value="diamond">Diamante</option>
          <option value="gold">Ouro</option>
          <option value="silver">Prata</option>
          <option value="bronze">Bronze</option>
        </select>
      </div>
      <div class="form-group">
        <label for="reward-cost">Custo (pontos)</label>
        <input type="number" id="reward-cost" placeholder="0" min="1">
      </div>
      <div class="form-group">
        <label for="reward-image">URL da Imagem</label>
        <input type="text" id="reward-image" placeholder="https://i.imgur.com/imagem.png">
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeRewardModal()">Cancelar</button>
        <button class="btn btn-primary" onclick="saveReward()">Salvar</button>
      </div>
    </div>
  </div>

  <div class="modal" id="assign-mission-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Atribuir missão</h2>
      </div>
      <div class="form-group">
        <label for="assign-user">Usuário</label>
        <select id="assign-user">
          <option value="">Carregando...</option>
        </select>
      </div>
      <div class="form-group">
        <label for="assign-mission">Missão</label>
        <select id="assign-mission">
          <option value="">Carregando...</option>
        </select>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeAssignMissionModal()">Cancelar</button>
        <button class="btn btn-primary" onclick="assignMission()">Atribuir e adicionar pontos</button>
      </div>
    </div>
  </div>

  <div class="modal" id="edit-user-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Editar usuário</h2>
      </div>
      <div class="form-group">
        <label for="edit-user-nick">Nick</label>
        <input type="text" id="edit-user-nick" disabled>
      </div>
      <div class="form-group">
        <label for="edit-user-points">Pontos</label>
        <input type="number" id="edit-user-points" min="0">
      </div>
      <div class="form-group">
        <label for="edit-user-reason">Motivo da alteração</label>
        <textarea id="edit-user-reason" placeholder="Digite o motivo..."></textarea>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeEditUserModal()">Cancelar</button>
        <button class="btn btn-primary" onclick="saveUserEdit()">Salvar alterações</button>
      </div>
    </div>
  </div>

  <div class="modal" id="reject-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Rejeitar missão</h2>
      </div>
      <div class="form-group">
        <label for="reject-reason">Motivo da rejeição</label>
        <textarea id="reject-reason" placeholder="Digite o motivo da rejeição..." rows="4"></textarea>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeRejectModal()">Cancelar</button>
        <button class="btn btn-danger" onclick="confirmReject()">Rejeitar</button>
      </div>
    </div>
  </div>

  <div class="modal" id="confirm-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="confirm-title">Confirmar</h2>
      </div>
      <p id="confirm-message" style="margin-bottom: 24px;"></p>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeConfirmModal()">Cancelar</button>
        <button class="btn btn-primary" id="confirm-action">Confirmar</button>
      </div>
    </div>
  </div>

  <script src="js/session.js"></script>
  <script src="js/supabase.js"></script>
  <script src="js/auth.js"></script>
  <script src="js/profile-header.js"></script>
  <script>
    (function() {
      if (!SessionManager.isAuthenticated()) {
        window.location.href = 'index.html';
      }
    })();
  </script>
  <script>
    if (!SessionManager.isAuthenticated()) {
        window.location.replace('index.html');
      } else {
        (async function() {
          if (!(await Auth.checkAuth()) || !(await Auth.checkAdmin())) return;
          ProfileHeader.init();

          let editingMissionId = null;
          let editingRewardId = null;
          let editingUserId = null;
          let currentRejectId = null;
          let timerInterval = null;

          window.showTab = function(tab) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(`tab-${tab}`).classList.add('active');
          };

          async function loadStats() {
            try {
              const users = await DB.users.getAll();
              document.getElementById('total-users').textContent = users.length;
              
              const pendingMissions = await DB.missions.getPendingWithDetails();
              document.getElementById('pending-count').textContent = pendingMissions.length;
              
              const totalPoints = users.reduce((sum, u) => sum + (u.points || 0), 0);
              document.getElementById('total-points').textContent = totalPoints.toLocaleString();
              
              try {
                const missionsToday = await DB.missions.getTodayCount();
                document.getElementById('missions-today').textContent = missionsToday;
              } catch (error) {
                console.error('Erro ao carregar missões hoje:', error);
                document.getElementById('missions-today').textContent = '0';
              }
            } catch (error) {
              console.error('Erro ao carregar stats:', error);
            }
          }

          window.openMissionModal = function(editId = null) {
            editingMissionId = editId;
            document.getElementById('mission-modal-title').textContent = editId ? 'Editar Missão' : 'Nova Missão';
            if (editId) {
              const mission = missions.find(m => m.id === editId);
              if (mission) {
                document.getElementById('mission-name').value = mission.name;
                document.getElementById('mission-description').value = mission.description || '';
                document.getElementById('mission-points').value = mission.points;
              }
            } else {
              document.getElementById('mission-name').value = '';
              document.getElementById('mission-description').value = '';
              document.getElementById('mission-points').value = '';
            }
            document.getElementById('mission-modal').classList.add('active');
          };

          window.closeMissionModal = function() {
            document.getElementById('mission-modal').classList.remove('active');
            editingMissionId = null;
          };

          window.saveMission = async function() {
            const name = document.getElementById('mission-name').value.trim();
            const description = document.getElementById('mission-description').value.trim();
            const points = parseInt(document.getElementById('mission-points').value);

            if (!name || !points) {
              Toast.show('Preencha nome e pontos', 'error');
              return;
            }

            try {
              const missionData = { name, description: description || null, points };
              if (editingMissionId) {
                await DB.missions.update(editingMissionId, missionData);
                Toast.show('Missão atualizada com sucesso!', 'success');
              } else {
                await DB.missions.create(missionData);
                Toast.show('Missão criada com sucesso!', 'success');
              }
              await loadMissions();
              closeMissionModal();
            } catch (error) {
              console.error('Erro ao salvar missão:', error);
              Toast.show('Erro ao salvar missão', 'error');
            }
          };

          let missions = [];
          window.loadMissions = async function() {
            try {
              missions = await DB.missions.getAll();
              const tbody = document.getElementById('missions-body');
              const table = document.getElementById('missions-table');
              const loading = document.getElementById('missions-loading');

              if (!missions || missions.length === 0) {
                loading.textContent = 'Nenhuma missão cadastrada';
                return;
              }

              loading.style.display = 'none';
              table.style.display = 'table';
              tbody.innerHTML = missions.map(m => `
                <tr>
                  <td>${m.name}</td>
                  <td>${m.description || '-'}</td>
                  <td>${m.points}</td>
                  <td>
                    <div class="action-btns">
                      <button class="icon-btn" onclick="openMissionModal(${m.id})" title="Editar">
                        <svg viewBox="0 0 256 256" fill="currentColor">
                          <path d="M227.31,73.37,182.63,28.69a16,16,0,0,0-22.63,0L36.69,152A15.86,15.86,0,0,0,32,163.31V208a16,16,0,0,0,16,16H92.69A15.86,15.86,0,0,0,104,219.31L227.31,96a16,16,0,0,0,0-22.63ZM92.69,208H48V163.31l88-88L180.69,120ZM192,108.68,147.31,64l24-24L216,84.68Z"></path>
                        </svg>
                      </button>
                      <button class="icon-btn danger" onclick="deleteMission(${m.id})" title="Excluir">
                        <svg viewBox="0 0 256 256" fill="currentColor">
                          <path d="M216,48H176V40a24,24,0,0,0-24-24H104A24,24,0,0,0,80,40v8H40a8,8,0,0,0,0,16h8V208a16,16,0,0,0,16,16H192a16,16,0,0,0,16-16V64h8a8,8,0,0,0,0-16ZM96,40a8,8,0,0,1,8-8h48a8,8,0,0,1,8,8v8H96Zm96,168H64V64H192ZM112,104v64a8,8,0,0,1-16,0V104a8,8,0,0,1,16,0Zm48,0v64a8,8,0,0,1-16,0V104a8,8,0,0,1,16,0Z"></path>
                        </svg>
                      </button>
                    </div>
                  </td>
                </tr>
              `).join('');
            } catch (error) {
              console.error('Erro ao carregar missões:', error);
              document.getElementById('missions-loading').textContent = 'Erro ao carregar missões';
            }
          };

          window.showConfirm = function(title, message, onConfirm) {
            document.getElementById('confirm-title').textContent = title;
            document.getElementById('confirm-message').textContent = message;
            document.getElementById('confirm-modal').classList.add('active');
            
            const confirmBtn = document.getElementById('confirm-action');
            const newBtn = confirmBtn.cloneNode(true);
            confirmBtn.parentNode.replaceChild(newBtn, confirmBtn);
            
            newBtn.onclick = async function() {
              await onConfirm();
              document.getElementById('confirm-modal').classList.remove('active');
            };
          };

          window.closeConfirmModal = function() {
            document.getElementById('confirm-modal').classList.remove('active');
          };

          window.deleteMission = async function(id) {
            showConfirm('Excluir missão', 'Tem certeza que deseja excluir esta missão?', async () => {
              try {
                await DB.missions.delete(id);
                Toast.show('Missão excluída com sucesso!', 'success');
                await loadMissions();
              } catch (error) {
                console.error('Erro ao excluir missão:', error);
                Toast.show('Erro ao excluir missão', 'error');
              }
            });
          };

          window.loadPendingMissions = async function() {
            try {
              const missions = await DB.missions.getPendingWithDetails();
              
              const tbody = document.getElementById('pending-missions-body');
              const table = document.getElementById('pending-missions-table');
              const loading = document.getElementById('pending-missions-loading');
              const badge = document.getElementById('pending-missions-count');
              
              if (badge) {
                badge.textContent = `${missions.length} pendente${missions.length !== 1 ? 's' : ''}`;
              }

              if (!missions || missions.length === 0) {
                loading.textContent = 'Nenhuma missão pendente';
                loading.style.display = 'block';
                table.style.display = 'none';
                return;
              }

              loading.style.display = 'none';
              table.style.display = 'table';
              
              tbody.innerHTML = missions.map(m => `
                <tr>
                  <td><strong>${m.users?.nick || 'Desconhecido'}</strong></td>
                  <td>${m.missions?.name || 'Missão'}</td>
                  <td>${m.missions?.points || 0} pts</td>
                  <td>
                    ${m.proof_url ? `
                      <a href="${m.proof_url}" target="_blank" class="proof-link" title="Ver comprovante">
                        <svg width="24" height="24" viewBox="0 0 256 256" fill="var(--cyan-primary)">
                          <path d="M216,104v96a16,16,0,0,1-16,16H56a16,16,0,0,1-16-16V104a16,16,0,0,1,16-16H80a8,8,0,0,1,0,16H56v96H200V104H176a8,8,0,0,1,0-16h24A16,16,0,0,1,216,104ZM93.66,69.66,120,43.31V128a8,8,0,0,0,16,0V43.31l26.34,26.35a8,8,0,0,0,11.32-11.32l-40-40a8,8,0,0,0-11.32,0l-40,40A8,8,0,0,0,93.66,69.66Z"></path>
                        </svg>
                      </a>
                    ` : '-'}
                  </td>
                  <td>${new Date(m.completed_at).toLocaleString('pt-BR')}</td>
                  <td>
                    <div class="action-btns">
                      <button class="icon-btn success" onclick="approveMission(${m.id})" title="Aprovar">
                        <svg viewBox="0 0 256 256" fill="currentColor">
                          <path d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm45.66-125.66a8,8,0,0,1,0,11.32l-56,56a8,8,0,0,1-11.32,0l-24-24a8,8,0,0,1,11.32-11.32L112,140.69l50.34-50.35A8,8,0,0,1,173.66,90.34Z"></path>
                        </svg>
                      </button>
                      <button class="icon-btn danger" onclick="openRejectModal(${m.id})" title="Rejeitar">
                        <svg viewBox="0 0 256 256" fill="currentColor">
                          <path d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm37.66-133.66a8,8,0,0,1,0,11.32L139.31,128l26.35,26.34a8,8,0,0,1-11.32,11.32L128,139.31l-26.34,26.35a8,8,0,0,1-11.32-11.32L116.69,128,90.34,101.66a8,8,0,0,1,11.32-11.32L128,116.69l26.34-26.35A8,8,0,0,1,165.66,90.34Z"></path>
                        </svg>
                      </button>
                    </div>
                  </td>
                </tr>
              `).join('');
            } catch (error) {
              console.error('Erro ao carregar missões pendentes:', error);
              document.getElementById('pending-missions-loading').textContent = 'Erro ao carregar missões';
            }
          };

          window.approveMission = async function(id) {
            showConfirm('Aprovar missão', 'Tem certeza que deseja APROVAR esta missão?', async () => {
              try {
                const admin = SessionManager.getUser();
                await DB.missions.approve(id, admin.id);
                Toast.show('Missão aprovada com sucesso!', 'success');
                await loadPendingMissions();
                await loadUsers();
                await loadStats();
              } catch (error) {
                console.error('Erro ao aprovar missão:', error);
                Toast.show('Erro ao aprovar missão', 'error');
              }
            });
          };

          window.openRejectModal = function(id) {
            currentRejectId = id;
            document.getElementById('reject-reason').value = '';
            document.getElementById('reject-modal').classList.add('active');
          };

          window.closeRejectModal = function() {
            currentRejectId = null;
            document.getElementById('reject-modal').classList.remove('active');
          };

          window.confirmReject = async function() {
            const reason = document.getElementById('reject-reason').value.trim();
            
            if (!reason) {
              Toast.show('Digite um motivo para a rejeição', 'error');
              return;
            }
            
            try {
              const admin = SessionManager.getUser();
              await DB.missions.reject(currentRejectId, reason, admin.id);
              closeRejectModal();
              Toast.show('Missão rejeitada com sucesso!', 'success');
              await loadPendingMissions();
            } catch (error) {
              console.error('Erro ao rejeitar missão:', error);
              Toast.show('Erro ao rejeitar missão', 'error');
            }
          };

          window.openRewardModal = function(editId = null) {
            editingRewardId = editId;
            if (editId) {
              const reward = rewards.find(r => r.id === editId);
              if (reward) {
                document.getElementById('reward-name').value = reward.name;
                document.getElementById('reward-description').value = reward.description || '';
                document.getElementById('reward-category').value = reward.category;
                document.getElementById('reward-cost').value = reward.cost;
                document.getElementById('reward-image').value = reward.image_url || '';
              }
            } else {
              document.getElementById('reward-name').value = '';
              document.getElementById('reward-description').value = '';
              document.getElementById('reward-category').value = 'diamond';
              document.getElementById('reward-cost').value = '';
              document.getElementById('reward-image').value = '';
            }
            document.getElementById('reward-modal').classList.add('active');
          };

          window.closeRewardModal = function() {
            document.getElementById('reward-modal').classList.remove('active');
            editingRewardId = null;
          };

          let rewards = [];
          window.saveReward = async function() {
            const name = document.getElementById('reward-name').value.trim();
            const description = document.getElementById('reward-description').value.trim();
            const category = document.getElementById('reward-category').value;
            const cost = parseInt(document.getElementById('reward-cost').value);
            const image = document.getElementById('reward-image').value.trim();

            if (!name || !cost) {
              Toast.show('Preencha nome e custo', 'error');
              return;
            }

            try {
              const rewardData = { name, description: description || null, category, cost, image_url: image };
              if (editingRewardId) {
                await DB.rewards.update(editingRewardId, rewardData);
                Toast.show('Recompensa atualizada com sucesso!', 'success');
              } else {
                await DB.rewards.create(rewardData);
                Toast.show('Recompensa criada com sucesso!', 'success');
              }
              await loadRewards();
              closeRewardModal();
            } catch (error) {
              console.error('Erro ao salvar recompensa:', error);
              Toast.show('Erro ao salvar recompensa', 'error');
            }
          };

          window.loadRewards = async function() {
            try {
              rewards = await DB.rewards.getAll();
              const tbody = document.getElementById('rewards-body');
              const table = document.getElementById('rewards-table');
              const loading = document.getElementById('rewards-loading');

              if (!rewards || rewards.length === 0) {
                loading.textContent = 'Nenhuma recompensa encontrada';
                return;
              }

              loading.style.display = 'none';
              table.style.display = 'table';
              tbody.innerHTML = rewards.map(r => `
                <tr>
                  <td>${r.name}</td>
                  <td>${r.category}</td>
                  <td>${r.cost} pts</td>
                  <td>${r.image_url ? '✅' : '❌'}</td>
                  <td>
                    <div class="action-btns">
                      <button class="icon-btn" onclick="openRewardModal(${r.id})" title="Editar">
                        <svg viewBox="0 0 256 256" fill="currentColor">
                          <path d="M227.31,73.37,182.63,28.69a16,16,0,0,0-22.63,0L36.69,152A15.86,15.86,0,0,0,32,163.31V208a16,16,0,0,0,16,16H92.69A15.86,15.86,0,0,0,104,219.31L227.31,96a16,16,0,0,0,0-22.63ZM92.69,208H48V163.31l88-88L180.69,120ZM192,108.68,147.31,64l24-24L216,84.68Z"></path>
                        </svg>
                      </button>
                      <button class="icon-btn danger" onclick="deleteReward(${r.id})" title="Excluir">
                        <svg viewBox="0 0 256 256" fill="currentColor">
                          <path d="M216,48H176V40a24,24,0,0,0-24-24H104A24,24,0,0,0,80,40v8H40a8,8,0,0,0,0,16h8V208a16,16,0,0,0,16,16H192a16,16,0,0,0,16-16V64h8a8,8,0,0,0,0-16ZM96,40a8,8,0,0,1,8-8h48a8,8,0,0,1,8,8v8H96Zm96,168H64V64H192ZM112,104v64a8,8,0,0,1-16,0V104a8,8,0,0,1,16,0Zm48,0v64a8,8,0,0,1-16,0V104a8,8,0,0,1,16,0Z"></path>
                        </svg>
                      </button>
                    </div>
                  </td>
                </tr>
              `).join('');
            } catch (error) {
              console.error('Erro ao carregar recompensas:', error);
              document.getElementById('rewards-loading').textContent = 'Erro ao carregar recompensas';
            }
          };

          window.deleteReward = async function(id) {
            showConfirm('Excluir recompensa', 'Tem certeza que deseja excluir esta recompensa?', async () => {
              try {
                await DB.rewards.delete(id);
                Toast.show('Recompensa excluída com sucesso!', 'success');
                await loadRewards();
              } catch (error) {
                console.error('Erro ao excluir recompensa:', error);
                Toast.show('Erro ao excluir recompensa', 'error');
              }
            });
          };

          window.loadUsers = async function() {
            try {
              const users = await DB.rankings.getFullRanking();
              const tbody = document.getElementById('users-body');
              const table = document.getElementById('users-table');
              const loading = document.getElementById('users-loading');

              if (!users || users.length === 0) {
                loading.textContent = 'Nenhum usuário encontrado';
                return;
              }

              loading.style.display = 'none';
              table.style.display = 'table';
              tbody.innerHTML = '';

              for (let i = 0; i < users.length; i++) {
                const u = users[i];
                const missions = await DB.missions.getByUser(u.id);
                tbody.innerHTML += `
                  <tr>
                    <td>#${i + 1}</td>
                    <td>
                      ${u.nick}
                      ${u.banned ? '<span class="banned-badge">BANIDO</span>' : ''}
                      ${u.is_admin ? ' 👑' : ''}
                    </td>
                    <td>${u.points}</td>
                    <td>${missions.length}</td>
                    <td>${u.is_admin ? 'Sim' : 'Não'}</td>
                    <td>
                      <div class="action-btns">
                        <button class="icon-btn" onclick="openEditUserModal('${u.id}')" title="Editar">
                          <svg viewBox="0 0 256 256" fill="currentColor">
                            <path d="M227.31,73.37,182.63,28.69a16,16,0,0,0-22.63,0L36.69,152A15.86,15.86,0,0,0,32,163.31V208a16,16,0,0,0,16,16H92.69A15.86,15.86,0,0,0,104,219.31L227.31,96a16,16,0,0,0,0-22.63ZM92.69,208H48V163.31l88-88L180.69,120ZM192,108.68,147.31,64l24-24L216,84.68Z"></path>
                          </svg>
                        </button>
                        ${u.banned ? `
                          <button class="icon-btn success" onclick="unbanUser('${u.id}')" title="Remover banimento">
                            <svg viewBox="0 0 256 256" fill="currentColor">
                              <path d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm45.66-125.66a8,8,0,0,1,0,11.32l-56,56a8,8,0,0,1-11.32,0l-24-24a8,8,0,0,1,11.32-11.32L112,140.69l50.34-50.35A8,8,0,0,1,173.66,90.34Z"></path>
                            </svg>
                          </button>
                        ` : `
                          <button class="icon-btn danger" onclick="banUser('${u.id}')" title="Banir">
                            <svg viewBox="0 0 256 256" fill="currentColor">
                              <path d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm37.66-133.66a8,8,0,0,1,0,11.32L139.31,128l26.35,26.34a8,8,0,0,1-11.32,11.32L128,139.31l-26.34,26.35a8,8,0,0,1-11.32-11.32L116.69,128,90.34,101.66a8,8,0,0,1,11.32-11.32L128,116.69l26.34-26.35A8,8,0,0,1,165.66,90.34Z"></path>
                            </svg>
                          </button>
                        `}
                      </div>
                    </td>
                  </tr>
                `;
              }
            } catch (error) {
              console.error('Erro ao carregar usuários:', error);
              document.getElementById('users-loading').textContent = 'Erro ao carregar usuários';
            }
          };

          window.openEditUserModal = async function(userId) {
            editingUserId = userId;
            const user = (await DB.users.getAll()).find(u => u.id === userId);
            if (user) {
              document.getElementById('edit-user-nick').value = user.nick;
              document.getElementById('edit-user-points').value = user.points;
              document.getElementById('edit-user-reason').value = '';
              document.getElementById('edit-user-modal').classList.add('active');
            }
          };

          window.closeEditUserModal = function() {
            editingUserId = null;
            document.getElementById('edit-user-modal').classList.remove('active');
          };

          window.saveUserEdit = async function() {
            const points = parseInt(document.getElementById('edit-user-points').value);
            const reason = document.getElementById('edit-user-reason').value.trim();

            if (isNaN(points) || points < 0) {
              Toast.show('Digite uma quantidade válida de pontos', 'error');
              return;
            }

            if (!reason) {
              Toast.show('Digite o motivo da alteração', 'error');
              return;
            }

            try {
              await DB.users.update(editingUserId, { points });
              Toast.show(`Pontos alterados para ${points}`, 'success');
              closeEditUserModal();
              await loadUsers();
              await loadStats();
            } catch (error) {
              console.error('Erro ao editar usuário:', error);
              Toast.show('Erro ao editar usuário', 'error');
            }
          };

          window.banUser = async function(userId) {
            showConfirm('Banir usuário', 'Tem certeza que deseja banir este usuário?', async () => {
              try {
                await DB.users.ban(userId);
                Toast.show('Usuário banido com sucesso!', 'success');
                await loadUsers();
              } catch (error) {
                console.error('Erro ao banir usuário:', error);
                Toast.show('Erro ao banir usuário', 'error');
              }
            });
          };

          window.unbanUser = async function(userId) {
            showConfirm('Remover banimento', 'Remover banimento deste usuário?', async () => {
              try {
                await DB.users.unban(userId);
                Toast.show('Banimento removido com sucesso!', 'success');
                await loadUsers();
              } catch (error) {
                console.error('Erro ao remover banimento:', error);
                Toast.show('Erro ao remover banimento', 'error');
              }
            });
          };

          window.loadQueue = async function() {
            try {
              const store = await DB.store.getStatus();
              const queue = await DB.redemptions.getQueue();
              const pendingRedemptions = await DB.redemptions.getPending();
              
              const tbody = document.getElementById('queue-body');
              const table = document.getElementById('queue-table');
              const loading = document.getElementById('queue-loading');
              const currentBox = document.getElementById('current-turn-box');
              const currentNick = document.getElementById('current-turn-nick');
              const skipBtn = document.getElementById('skip-turn-btn');
              const turnInfo = document.getElementById('current-turn-info');
              const currentTurn = await DB.redemptions.getCurrentTurn();

              if (queue.length === 0) {
                loading.innerHTML = '<div class="empty-state">Nenhum usuário na fila</div>';
                loading.style.display = 'block';
                table.style.display = 'none';
                currentBox.style.display = 'none';
                turnInfo.innerHTML = 'Fila vazia';
                if (skipBtn) skipBtn.disabled = true;
                return;
              }

              loading.style.display = 'none';
              table.style.display = 'table';

              if (store.is_open) {
                if (currentTurn) {
                  currentNick.textContent = currentTurn.nick;
                  currentBox.style.display = 'flex';
                  if (skipBtn) skipBtn.disabled = false;
                  turnInfo.innerHTML = `Vez: ${currentTurn.nick}`;
                  
                  if (timerInterval) clearInterval(timerInterval);
                  startTimer(store.turn_start_time);
                } else {
                  currentBox.style.display = 'none';
                  if (skipBtn) skipBtn.disabled = true;
                  turnInfo.innerHTML = 'Aguardando próximo turno';
                }
              } else {
                currentBox.style.display = 'none';
                if (skipBtn) skipBtn.disabled = true;
                turnInfo.innerHTML = '🔴 Loja fechada';
              }

              tbody.innerHTML = queue.map((user, index) => {
                const isCurrent = currentTurn && currentTurn.id === user.id;
                const userPending = pendingRedemptions.filter(r => r.user_id === user.id).length;
                return `
                  <tr style="${isCurrent ? 'background-color: rgba(117, 175, 202, 0.1); font-weight: bold;' : ''}">
                    <td>${index + 1}° ${isCurrent ? '(ATUAL)' : ''}</td>
                    <td>${user.nick}</td>
                    <td>${user.points}</td>
                    <td>${userPending} resgate(s)</td>
                    <td>${isCurrent ? 'Jogando' : 'Aguardando'}</td>
                  </tr>
                `;
              }).join('');
            } catch (error) {
              console.error('Erro ao carregar fila:', error);
              document.getElementById('queue-loading').innerHTML = '<div class="empty-state">Erro ao carregar fila</div>';
            }
          };

          function startTimer(startTime) {
            if (timerInterval) clearInterval(timerInterval);
            
            timerInterval = setInterval(async () => {
              try {
                const remaining = await DB.store.getRemainingTime();
                const mins = Math.floor(remaining / 60);
                const secs = remaining % 60;
                const timerEl = document.getElementById('turn-timer');
                if (timerEl) {
                  timerEl.textContent = `${mins.toString().padStart(2,'0')}:${secs.toString().padStart(2,'0')}`;
                }
                
                if (remaining <= 0) {
                  clearInterval(timerInterval);
                  await DB.redemptions.processNextTurn();
                  loadQueue();
                }
              } catch (error) {
                console.error('Erro no timer:', error);
              }
            }, 1000);
          }

          window.skipTurn = async function() {
            showConfirm('Pular vez', 'Pular a vez do usuário atual?', async () => {
              try {
                await DB.redemptions.processNextTurn();
                Toast.show('Vez pulada com sucesso!', 'success');
                loadQueue();
              } catch (error) {
                console.error('Erro ao pular vez:', error);
                Toast.show('Erro ao pular vez', 'error');
              }
            });
          };

          window.loadStoreSettings = async function() {
            try {
              const status = await DB.store.getStatus();
              document.getElementById('store-status').checked = status.is_open;
              if (status.next_open_date) {
                document.getElementById('next-opening').value = new Date(status.next_open_date).toISOString().slice(0,16);
              }
            } catch (error) {
              console.error('Erro ao carregar configurações:', error);
            }
          };

          window.toggleStoreStatus = function() {};

          window.saveStoreSettings = async function() {
            try {
              const isOpen = document.getElementById('store-status').checked;
              let nextOpening = document.getElementById('next-opening').value;
              
              if (!nextOpening) {
                const nextDate = await DB.store.calculateNextOpenDate();
                nextOpening = nextDate.slice(0,16);
              }
              
              await DB.store.setStatus(isOpen, nextOpening || null);
              
              if (isOpen) {
                await DB.redemptions.processNextTurn();
                Toast.show('✅ Loja aberta! Fecha automaticamente dia 10.', 'success');
              } else {
                if (nextOpening) {
                  const date = new Date(nextOpening).toLocaleDateString('pt-BR');
                  Toast.show(`🔴 Loja fechada. Próxima abertura: ${date}`, 'success');
                } else {
                  Toast.show('🔴 Loja fechada. Configurações salvas!', 'success');
                }
              }
              
              loadQueue();
            } catch (error) {
              console.error('Erro ao salvar configurações:', error);
              Toast.show('Erro ao salvar configurações', 'error');
            }
          };

          await loadStats();
          await loadMissions();
          await loadRewards();
          await loadUsers();
          await loadQueue();
          await loadStoreSettings();
          await loadPendingMissions();

          setInterval(async () => {
            await loadStats();
            await loadQueue();
            await DB.store.checkAutoClose();
            await DB.store.checkAndOpenNext();
          }, 30000);
        })();
      }

    document.addEventListener('DOMContentLoaded', function() {
      const menuToggle = document.getElementById('menuToggle');
      const sidebar = document.querySelector('.sidebar');
      const overlay = document.getElementById('sidebarOverlay');
      
      if (menuToggle && sidebar && overlay) {
        menuToggle.addEventListener('click', function() {
          sidebar.classList.toggle('active');
          overlay.classList.toggle('active');
          const icon = menuToggle.querySelector('i');
          if (sidebar.classList.contains('active')) {
            icon.className = 'ph ph-x';
          } else {
            icon.className = 'ph ph-list';
          }
        });
        
        overlay.addEventListener('click', function() {
          sidebar.classList.remove('active');
          overlay.classList.remove('active');
          const icon = menuToggle.querySelector('i');
          icon.className = 'ph ph-list';
        });
      }

      const user = SessionManager.getUser();
      const adminNavItem = document.getElementById('admin-nav-item');
      if (adminNavItem && user && user.isAdmin) {
        adminNavItem.style.display = 'block';
      }
    });
  </script>
</body>
</html>
